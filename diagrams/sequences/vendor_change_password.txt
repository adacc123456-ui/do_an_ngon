title: Vendor đổi mật khẩu trong phần Cài đặt tài khoản

participant Vendor as "Chủ cửa hàng"
participant ChangeUI as "VendorChangePasswordPage"
participant AuthBloc as "AuthBloc"
participant AuthRepo as "AuthRepository"
participant Api as "ApiClient"
participant Backend as "Auth Service"

Vendor->ChangeUI: Mở màn "Đổi mật khẩu"
ChangeUI->Vendor: Hiển thị 3 ô Current/New/Confirm
Vendor->ChangeUI: Nhập thông tin và nhấn "Xác nhận"

ChangeUI->AuthBloc: Dispatch ChangePasswordEvent(current,newPassword)
AuthBloc->AuthRepo: changePassword(current,newPassword)
AuthRepo->Api: POST /auth/change-password
Api->Backend: Kiểm tra mật khẩu cũ\ncập nhật mật khẩu mới
Backend-->Api: Success / lỗi
Api-->AuthRepo: Response
AuthRepo-->AuthBloc: Result
AuthBloc->ChangeUI: state = ChangePasswordSuccess/Failure

alt Thành công
  ChangeUI->Vendor: Snackbar "Đổi mật khẩu thành công"
  ChangeUI->ChangeUI: context.go('/vendor-account-information')
else Sai mật khẩu cũ / không khớp xác nhận
  AuthRepo-->AuthBloc: ApiException(message)
  AuthBloc->ChangeUI: state = ChangePasswordFailure(message)
  ChangeUI->Vendor: Hiển thị lỗi dưới ô input
end

newpage Hoạt động (PlantUML): Vendor đổi mật khẩu
@startuml
|Chủ cửa hàng|
start
:Mở trang Đổi mật khẩu;
|Hệ thống|
:Hiển thị ô nhập mật khẩu cũ/mới/xác nhận;
|Chủ cửa hàng|
:Nhập thông tin và nhấn "Xác nhận";
|Hệ thống|
:Kiểm tra mật khẩu cũ, độ mạnh, khớp xác nhận;
if (Hợp lệ?) then (Có)
  :Cập nhật mật khẩu mới;
  :Thông báo thành công + quay lại Account Settings;
else (Không)
  :Hiển thị lỗi chi tiết;
  |Chủ cửa hàng|
  repeat
    :Nhập lại thông tin;
    |Hệ thống|
    :Kiểm tra lại;
  repeat while (Còn lỗi?)
endif
stop
@enduml
